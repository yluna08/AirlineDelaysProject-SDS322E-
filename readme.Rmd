
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Project Overview:

**Description**: 

Our project analyzes the data of domestic flights within America in order to find unique relationships between certain factors that can vary for an airplane's flight.

**Goals**:

- Look at the relationship between airports and delay times 
  - Are some airports better at avoiding delays? (least amount of delays? Or shortest delay times? either) 
  - What kind of delays are they better at avoiding? 
  
- Look at what kind of delay causes the longest departure delay 

**Data**:

The Airline On-Time Performance Data is a data set collected over time by the United States Department of Transportation. In this dataset, carriers report data for the flights operated, including their arrival/departure dates, carrier, origin, airport, causes of delay and cancellation, air time, and non-stop distance. The dataset spans from 1987 to the present. 
[link to data](https://drive.google.com/file/d/1ewoXW2YnCfzAoJ-pPHaR0raOpHCyktMi/view?usp=drive_web)

**Hypotheses**:

- What is the relationship between airports and delay times 
  - We predict that major airports in America are best at avoiding delays.

- What kind of delay causes the longest departure delay 
  - We predict that averaged across all airports, the security delay has the shortest delay time, and the weather        delay has the longest delay time.

**References**: [data from website](https://www.transtats.bts.gov/Fields.asp?gnoyr_VQ=FGJ)

```{r}
# setting up data to work with it
library(tidyverse)
airplanes <- read.csv("T_ONTIME_MARKETING.csv")

# looking at dataset
glimpse(airplanes)

# first data visualization
airplanes %>% group_by(ORIGIN_AIRPORT_ID) %>%
  mutate(f=n()) %>%
  mutate(size_group = case_when(
  f >= 20000 ~ '>=20000',
  f >= 15000 ~ '>=15000',
  f >= 10000 ~ '>=10000',
  f >= 5000 ~ '>=5000',
  f >= 1000 ~ '>=1000',
  f >= 500 ~ '>=500',
  TRUE ~ '<=500')) %>%
  mutate(size_group = factor(size_group,
                         	levels = c('>=20000',
                                    	'>=15000',
                                    	'>=10000',
                                    	'>=5000',
                                    	'>=1000',
                                    	'>=500',
                                    	'<=500'))) %>%
  ggplot(aes(x=size_group, y=DEP_DELAY)) + geom_bar(stat='summary') +
  geom_errorbar(stat='summary', width = 0.2) +
  labs(x = 'number of departure flights', y = 'departure delay (min)',
   	title = 'Departure delay by airport size')


# second data visualization 

airplanes %>% filter(!is.na(CARRIER_DELAY)) %>%
  mutate(main_cause = case_when(
	pmax(CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY) == CARRIER_DELAY ~ "carrier",
	pmax(CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY) == WEATHER_DELAY ~ "weather",
	pmax(CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY) == NAS_DELAY ~ 'nas',
	pmax(CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY) == SECURITY_DELAY ~ "security",
	pmax(CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY) == LATE_AIRCRAFT_DELAY ~ "late_aircraft",
	TRUE ~ "none"
  )) %>%
  ggplot(aes(x=DEP_DELAY, fill=main_cause)) + geom_density(alpha = 0.5) + scale_x_log10() + labs(x='departure delay (min)')


```

